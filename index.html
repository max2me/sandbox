<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Sensor v3</title>
    <style>
      html, body {
background-color: #000;
      }
      #result { font-size: 200px; transform: rotate(90deg); color: #FFF; position: absolute; left: 50vh; top: 50vh; margin-left: -50%; margin-top: -50%; }
    </style>
</head>
<body>
<main role="main" class="container">

<div id="demo-div">
  <a id="start_demo"  href="#" role="button">Start the demo</a>
</div>
</main>
  <div id="result">0</div>
  
<script>
var seconds = 0.0;
var int = null;
var beta = -100;
  
function handleOrientation(event) {
  if (event.beta != null) {
    beta = event.beta.toFixed(2);
  }
}

let is_running = false;
let demo_button = document.getElementById("start_demo");
demo_button.onclick = function(e) {
  e.preventDefault();
  
  // Request permission for iOS 13+ devices
  if (
    DeviceMotionEvent &&
    typeof DeviceMotionEvent.requestPermission === "function"
  ) {
    DeviceMotionEvent.requestPermission();
  }
  
  if (is_running){
    window.removeEventListener("deviceorientation", handleOrientation);
    demo_button.innerHTML = "Start demo";
    is_running = false;
    clearInterval(int);
  }else{
    window.addEventListener("deviceorientation", handleOrientation);
    document.getElementById("start_demo").innerHTML = "Stop demo";
    is_running = true;
    int = setInterval(function() {
       if (Math.abs(beta) < 12) {
          seconds += 0.25;
       }

      document.getElementById('result').innerHTML = Math.floor(seconds);
    }, 250);
  }
};
</script>
</body>
</html>
